<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<title>আম্মারকে বাঁচান</title>

<link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;600;700&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  font-family:'Hind Siliguri',sans-serif;
  background:#fcf9c5;
  overflow:hidden;
}

#game{
  position:relative;
  max-width:450px;
  height:100vh;
  margin:auto;
  background:#fcf9c5;
  overflow:hidden;
}

/* HUD */
#hud{
  position:absolute;
  top:15px;
  left:50%;
  transform:translateX(-50%);
  display:flex;
  gap:6px;
  background:#fff9c4;
  border:2px solid #e0cf8d;
  padding:8px;
  border-radius:14px;
  z-index:1000;
  font-weight:800;
}

.pill{
  background:#fff;
  padding:6px 8px;
  border-radius:10px;
  font-size:13px;
}

.btn{
  border:none;
  border-radius:10px;
  padding:7px 12px;
  font-weight:900;
  color:white;
  cursor:pointer;
}

.start{background:#5c8aff;}
.pause{background:#777;}
.share{background:#33a853;}

/* Player */
#player{
  position:absolute;
  bottom:140px;
  left:50%;
  width:80px;
  height:80px;
  transform:translateX(-50%);
  background:url('ammar.png') no-repeat center/contain;
}

/* Enemy */
.enemy{
  position:absolute;
  width:55px;
  height:55px;
  background:url('bcl.png') no-repeat center/contain;
}

/* Overlay */
#overlay{
  position:absolute;
  inset:0;
  background:rgba(0,0,0,.4);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:2000;
}

#modal{
  width:85%;
  background:white;
  border-radius:18px;
  padding:20px;
  text-align:center;
  border:4px solid #2e7d32;
}

#modal h2{
  margin:0;
  color:#2e7d32;
  font-weight:900;
}

#modal .text{
  text-align:left;
  font-weight:800;
  line-height:1.6;
  margin:12px 0;
  color:#222;
}

.bigbtn{
  width:100%;
  padding:12px;
  border:none;
  border-radius:10px;
  margin:6px 0;
  font-size:17px;
  font-weight:900;
  cursor:pointer;
  color:white;
}

.blue{background:#5c8aff;}
.green{background:#33a853;}
.gray{background:#ccc;color:#222;}

#credit{
  position:absolute;
  bottom:6px;
  left:50%;
  transform:translateX(-50%);
  font-size:12px;
  font-weight:800;
  opacity:.7;
}
</style>
</head>

<body>

<div id="game">

<!-- HUD -->
<div id="hud">
  <div class="pill">Score: <span id="score">0</span></div>
  <div class="pill">Time: <span id="time">00:00</span></div>

  <button class="btn start" id="btnStart">Start</button>
  <button class="btn pause" id="btnPause">Pause</button>
  <button class="btn share" id="btnShare">Share</button>
</div>

<!-- Player -->
<div id="player"></div>

<!-- Overlay -->
<div id="overlay">
  <div id="modal">
    <h2 id="title">ছাত্রলীগের হাত থেকে আম্মারকে বাঁচান</h2>

    <div class="text" id="body">
      <b>খেলার নিয়ম:</b><br>
      ১) আঙুল টেনে আম্মারকে নড়ান<br>
      ২) উপরের লোগো এড়ান<br>
      ৩) লাগলে খেলা শেষ<br>
      ৪) যত বাঁচবেন স্কোর বাড়বে<br>
      <span style="color:red">⚠️ সাবধান!</span>
    </div>

    <button class="bigbtn green" id="btnMain">খেলা শুরু করুন</button>
    <button class="bigbtn gray" id="btnClose">Close</button>
  </div>
</div>

<!-- Credit -->
<div id="credit">
  Developed by রাজশাহী বিশ্ববিদ্যালয় ছাত্রলীগ
</div>

</div>

<script>
const game = document.getElementById("game");
const player = document.getElementById("player");

const scoreEl = document.getElementById("score");
const timeEl = document.getElementById("time");

const overlay = document.getElementById("overlay");
const title = document.getElementById("title");
const body = document.getElementById("body");

const btnMain = document.getElementById("btnMain");
const btnClose = document.getElementById("btnClose");

const btnStart = document.getElementById("btnStart");
const btnPause = document.getElementById("btnPause");
const btnShare = document.getElementById("btnShare");

let state="menu";
let score=0;
let startTime=0;
let last=0;

let enemies=[];
let nextSpawn=0;
let drag=false;

/* Utils */
function timeFmt(s){
  return String(Math.floor(s/60)).padStart(2,"0")+":"+
         String(s%60).padStart(2,"0");
}

/* Overlay */
function show(type){
  overlay.style.display="flex";

  if(type==="menu"){
    title.innerText="ছাত্রলীগের হাত থেকে আম্মারকে বাঁচান";

    body.innerHTML=`
      <b>খেলার নিয়ম:</b><br>
      ১) আঙুল টেনে আম্মারকে নড়ান<br>
      ২) উপরের লোগো এড়ান<br>
      ৩) লাগলে খেলা শেষ<br>
      ৪) যত বাঁচবেন স্কোর বাড়বে<br>
      <span style="color:red">⚠️ সাবধান!</span>
    `;

    btnMain.innerText="খেলা শুরু করুন";
    btnMain.onclick=start;

    btnClose.onclick=hide;
  }

  if(type==="paused"){
    title.innerText="Paused";
    body.innerHTML="Resume করতে নিচের বাটনে চাপুন";

    btnMain.innerText="Resume";
    btnMain.onclick=resume;

    btnClose.onclick=hide;
  }

  if(type==="over"){
    document.getElementById("modal").style.borderColor="#d32f2f";
    title.style.color="#d32f2f";

    title.innerText="খেলা শেষ!";

    body.innerHTML=`
      <b>ছাত্রলীগ আম্মারকে ধরে ফেলেছে</b><br><br>
      আপনার স্কোর: <span style="color:red">${score}</span>
    `;

    btnMain.innerText="আবার খেলুন";
    btnMain.onclick=start;

    btnClose.innerText="ফলো করুন";
    btnClose.onclick=()=>{
      window.open("https://facebook.com","_blank");
    };
  }
}

function hide(){
  overlay.style.display="none";
}

/* Game */
function reset(){
  enemies.forEach(e=>e.el.remove());
  enemies=[];

  score=0;
  scoreEl.innerText=0;

  startTime=performance.now();
  last=startTime;

  timeEl.innerText="00:00";
  nextSpawn=startTime+700;
}

function start(){
  reset();
  state="playing";
  btnPause.innerText="Pause";
  hide();
}

function pause(){
  if(state!=="playing")return;
  state="paused";
  btnPause.innerText="Resume";
  show("paused");
}

function resume(){
  if(state!=="paused")return;
  state="playing";
  last=performance.now();
  btnPause.innerText="Pause";
  hide();
}

function over(){
  if(state==="over")return;
  state="over";
  show("over");
}

/* Drag */
game.addEventListener("pointerdown",e=>{
  drag=true;
  move(e.clientX);
});

game.addEventListener("pointermove",e=>{
  if(!drag)return;
  move(e.clientX);
});

game.addEventListener("pointerup",()=>drag=false);

function move(x){
  const r=game.getBoundingClientRect();
  let p=x-r.left;

  p=Math.max(40,Math.min(r.width-40,p));
  player.style.left=p+"px";
}

/* Enemies */
function spawn(){
  const el=document.createElement("div");
  el.className="enemy";

  const x=Math.random()*(game.clientWidth-55);

  game.appendChild(el);

  enemies.push({
    el,
    x,
    y:-60,
    speed:220+score*10
  });
}

function hit(a,b){
  return !(a.right<b.left||a.left>b.right||
           a.bottom<b.top||a.top>b.bottom);
}

/* Loop */
function loop(t){

  requestAnimationFrame(loop);

  if(state!=="playing")return;

  const dt=Math.min(.03,(t-last)/1000);
  last=t;

  timeEl.innerText=timeFmt((t-startTime)/1000);

  if(t>nextSpawn){
    spawn();
    nextSpawn=t+Math.max(400,1100-score*6);
  }

  const pr=player.getBoundingClientRect();

  for(let i=enemies.length-1;i>=0;i--){

    let o=enemies[i];

    o.y+=o.speed*dt;

    o.el.style.transform=
      `translate(${o.x}px,${o.y}px)`;

    const er=o.el.getBoundingClientRect();

    if(hit(pr,er)){
      over();
      return;
    }

    if(o.y>window.innerHeight){
      o.el.remove();
      enemies.splice(i,1);
      score++;
      scoreEl.innerText=score;
    }
  }
}

requestAnimationFrame(t=>{last=t;loop(t)});

/* Share */
btnShare.onclick=()=>{
  const text=`আমি ${score} স্কোর করেছি!`;
  const url=location.href;

  if(navigator.share)
    navigator.share({text,url});
  else
    window.open(`https://wa.me/?text=${encodeURIComponent(text+" "+url)}`);
};

/* Buttons */
btnStart.onclick=start;
btnPause.onclick=()=>state==="paused"?resume():pause();
btnMain.onclick=start;
btnClose.onclick=hide;

/* Init */
show("menu");
</script>

</body>
</html>
