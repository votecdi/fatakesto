<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<title>আম্মারকে বাঁচান</title>

<link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;600;700&display=swap" rel="stylesheet">

<style>
:root{ --bg:#fcf9c5; }

body{
  margin:0;
  font-family:'Hind Siliguri',sans-serif;
  background:var(--bg);
  overflow:hidden;

  position:fixed;
  width:100%;
  overscroll-behavior:none;
  touch-action:none;
}

/* Game Area */
#game{
  position:relative;
  max-width:450px;
  height:100svh;
  min-height:100vh;
  margin:0 auto;
  background:var(--bg);
  overflow:hidden;

  transform:translateZ(0);
  contain:layout paint;
}

/* HUD */
#hud{
  position:fixed;
  top:14px;
  left:50%;
  transform:translateX(-50%);
  display:flex;
  gap:8px;
  align-items:center;
  background:#fff9c4;
  border:2px solid #e0cf8d;
  padding:10px;
  border-radius:16px;
  z-index:1000;
  font-weight:900;
  box-shadow:0 6px 16px rgba(0,0,0,.1);
}

.pill{
  background:#fff;
  padding:6px 10px;
  border-radius:12px;
  font-size:13px;
  color:#222;
  min-width:80px;
}

.btn{
  border:none;
  border-radius:12px;
  padding:8px 12px;
  font-weight:900;
  color:white;
  cursor:pointer;
}

.btn:active{transform:scale(.96);}

.start{background:#5c8aff;}
.pause{background:#777;}
.share{background:#33a853;}

/* Player */
#player{
  position:absolute;
  bottom:140px;
  left:0;
  width:80px;
  height:80px;
  background:url('ammar.png') no-repeat center/contain;
  pointer-events:none;
  z-index:10;

  will-change:transform;
  transform:translate3d(0,0,0);
  backface-visibility:hidden;
}

/* Enemy */
.enemy{
  position:absolute;
  left:0;
  top:0;
  width:55px;
  height:55px;
  background:url('bcl.png') no-repeat center/contain;
  pointer-events:none;
  z-index:9;

  will-change:transform;
  transform:translate3d(0,0,0);
  backface-visibility:hidden;
}

/* Overlay */
#overlay{
  position:absolute;
  inset:0;
  background:rgba(0,0,0,.4);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:2000;
  padding:16px;
}

#modal{
  width:88%;
  max-width:420px;
  background:white;
  border-radius:20px;
  padding:20px;
  text-align:center;
  border:4px solid #2e7d32;
  box-shadow:0 14px 34px rgba(0,0,0,.28);
}

#modal h2{
  margin:0;
  font-size:22px;
  font-weight:900;
  color:#2e7d32;
}

#modal .text{
  text-align:left;
  font-weight:800;
  line-height:1.6;
  margin:12px 0;
  color:#222;
}

.bigbtn{
  width:100%;
  padding:12px;
  border:none;
  border-radius:12px;
  margin:8px 0 0;
  font-size:18px;
  font-weight:900;
  cursor:pointer;
  color:white;
}

.green{background:#33a853;}
.gray{background:#ccc;color:#222;}

/* Credit */
#credit{
  position:fixed;
  left:50%;
  transform:translateX(-50%);
  bottom:max(8px,env(safe-area-inset-bottom));
  font-size:12px;
  font-weight:900;
  color:#333;
  opacity:.8;
  z-index:1200;
}
</style>
</head>

<body>

<div id="game">

<!-- HUD -->
<div id="hud">
  <div class="pill">Score: <span id="score">0</span></div>
  <div class="pill">Time: <span id="time">00:00</span></div>

  <button class="btn start" id="btnStart">Start</button>
  <button class="btn pause" id="btnPause">Pause</button>
  <button class="btn share" id="btnShare">Share</button>
</div>

<div id="player"></div>

<!-- Overlay -->
<div id="overlay">
  <div id="modal">

    <h2 id="title">ছাত্রলীগের হাত থেকে আম্মারকে বাঁচান</h2>

    <div class="text" id="body">
      <b>খেলার নিয়ম:</b><br>
      ১) আঙুল টেনে আম্মারকে নড়ান<br>
      ২) লোগো এড়ান<br>
      ৩) লাগলে খেলা শেষ<br>
      ৪) যত বাঁচবেন স্কোর বাড়বে<br>
      ⚠️ সাবধান!
    </div>

    <button class="bigbtn green" id="btnMain">খেলা শুরু করুন</button>
    <button class="bigbtn gray" id="btnClose">Close</button>

  </div>
</div>

<!-- Credit -->
<div id="credit"></div>

</div>

<script>
// ================= CREDIT OPTION =================
const CREDIT_SHOW = true;
const CREDIT_TEXT = "Developed by রাজশাহী বিশ্ববিদ্যালয় ছাত্রলীগ";
const CREDIT_LINK = ""; // চাইলে লিংক দাও

const creditEl = document.getElementById("credit");

if(!CREDIT_SHOW){
  creditEl.style.display="none";
}else{
  if(CREDIT_LINK){
    creditEl.innerHTML =
      `<a href="${CREDIT_LINK}" target="_blank"
       style="color:inherit;text-decoration:none">
       ${CREDIT_TEXT}
       </a>`;
  }else{
    creditEl.textContent = CREDIT_TEXT;
  }
}
// ================================================

// DOM
const game=document.getElementById("game");
const player=document.getElementById("player");

const scoreEl=document.getElementById("score");
const timeEl=document.getElementById("time");

const overlay=document.getElementById("overlay");
const modal=document.getElementById("modal");
const title=document.getElementById("title");
const body=document.getElementById("body");

const btnMain=document.getElementById("btnMain");
const btnClose=document.getElementById("btnClose");

const btnStart=document.getElementById("btnStart");
const btnPause=document.getElementById("btnPause");
const btnShare=document.getElementById("btnShare");

// State
let state="menu";
let score=0;

let startTime=0;
let last=0;

const PLAYER_W=80, PLAYER_H=80;
const ENEMY_W=55, ENEMY_H=55;

let playerX=0;
let drag=false;

let enemies=[];
let nextSpawn=0;

const POOL=[];

// Utils
function fmt(s){
  s=Math.max(0,s|0);
  return String(Math.floor(s/60)).padStart(2,"0")+":"+
         String(s%60).padStart(2,"0");
}

function playerY(){
  return game.clientHeight-140-PLAYER_H;
}

function setPlayerX(x){
  const w=game.clientWidth;
  playerX=Math.max(0,Math.min(w-PLAYER_W,x));

  player.style.transform=
   `translate3d(${Math.round(playerX)}px,0,0)`;
}

function centerPlayer(){
  setPlayerX((game.clientWidth-PLAYER_W)/2);
}

// Overlay
function show(type){

  overlay.style.display="flex";
  overlay.style.pointerEvents="auto";

  modal.style.borderColor="#2e7d32";
  title.style.color="#2e7d32";

  if(type==="menu"){

    title.innerText="ছাত্রলীগের হাত থেকে আম্মারকে বাঁচান";

    btnMain.innerText="খেলা শুরু করুন";
    btnMain.onclick=startGame;

    btnClose.onclick=hide;
  }

  if(type==="paused"){

    title.innerText="Paused";
    body.innerHTML="Resume করতে নিচের বাটনে চাপুন";

    btnMain.innerText="Resume";
    btnMain.onclick=resumeGame;

    btnClose.onclick=hide;
  }

  if(type==="over"){

    modal.style.borderColor="#d32f2f";
    title.style.color="#d32f2f";

    title.innerText="খেলা শেষ!";

    body.innerHTML=`
      ছাত্রলীগ আম্মারকে ধরে ফেলেছে<br><br>
      স্কোর: <b>${score}</b>
    `;

    btnMain.innerText="আবার খেলুন";
    btnMain.onclick=startGame;

    btnClose.innerText="ফলো করুন";
    btnClose.onclick=()=>{
      window.open("https://facebook.com","_blank");
    };
  }
}

function hide(){
  overlay.style.display="none";
  overlay.style.pointerEvents="none";
}

// Game
function reset(){

  for(const o of enemies){
    o.el.style.visibility="hidden";
    POOL.push(o.el);
  }

  enemies=[];

  score=0;
  scoreEl.innerText=0;
  timeEl.innerText="00:00";

  startTime=performance.now();
  last=startTime;

  nextSpawn=startTime+700;

  centerPlayer();
}

function startGame(){
  reset();
  state="playing";
  btnPause.innerText="Pause";
  hide();
}

function pauseGame(){
  if(state!=="playing")return;

  state="paused";
  btnPause.innerText="Resume";
  show("paused");
}

function resumeGame(){
  if(state!=="paused")return;

  state="playing";
  last=performance.now();
  btnPause.innerText="Pause";
  hide();
}

function gameOver(){
  if(state==="over")return;

  state="over";
  show("over");
}

function togglePause(){
  if(state==="playing")pauseGame();
  else if(state==="paused")resumeGame();
}

// Drag
function move(x){
  const r=game.getBoundingClientRect();
  setPlayerX(x-r.left-PLAYER_W/2);
}

game.addEventListener("pointerdown",e=>{
  drag=true;
  try{game.setPointerCapture(e.pointerId);}catch{}
  move(e.clientX);
});

game.addEventListener("pointermove",e=>{
  if(!drag)return;
  e.preventDefault();
  move(e.clientX);
});

game.addEventListener("pointerup",()=>drag=false);
game.addEventListener("pointercancel",()=>drag=false);

// Enemies
function getEnemy(){
  const el=POOL.pop();
  if(el)return el;

  const n=document.createElement("div");
  n.className="enemy";
  game.appendChild(n);

  return n;
}

function spawn(){
  const el=getEnemy();
  el.style.visibility="visible";

  const x=Math.random()*(game.clientWidth-ENEMY_W);

  enemies.push({
    el,
    x,
    y:-ENEMY_H,
    speed:260+score*14
  });
}

function hit(px,py,ex,ey){
  return !(px+PLAYER_W<ex||px>ex+ENEMY_W||
           py+PLAYER_H<ey||py>ey+ENEMY_H);
}

// Loop
function loop(t){

  requestAnimationFrame(loop);

  if(state!=="playing")return;

  const dt=Math.min(.033,(t-last)/1000);
  last=t;

  timeEl.innerText=fmt((t-startTime)/1000);

  if(t>nextSpawn){
    spawn();
    nextSpawn=t+Math.max(340,980-score*6);
  }

  const py=playerY();

  for(let i=enemies.length-1;i>=0;i--){

    const o=enemies[i];

    o.y+=o.speed*dt;

    o.el.style.transform=
     `translate3d(${Math.round(o.x)}px,${Math.round(o.y)}px,0)`;

    if(hit(playerX,py,o.x,o.y)){
      gameOver();
      return;
    }

    if(o.y>game.clientHeight+140){

      o.el.style.visibility="hidden";
      POOL.push(o.el);
      enemies.splice(i,1);

      score++;
      scoreEl.innerText=score;
    }
  }
}

// Share
btnShare.onclick=()=>{

  const text=`আমি ${score} স্কোর করেছি!`;
  const url=location.href;

  if(navigator.share)
    navigator.share({text,url});
  else
    window.open(`https://wa.me/?text=${encodeURIComponent(text+" "+url)}`);
};

// PC + Mobile Button Fix
function bindBtn(el,fn){
  if(!el)return;

  el.addEventListener("click",e=>{
    e.preventDefault();
    fn();
  });

  el.addEventListener("pointerup",e=>{
    e.preventDefault();
    fn();
  });
}

bindBtn(btnStart,startGame);
bindBtn(btnMain,startGame);

btnPause.addEventListener("click",togglePause);
btnClose.addEventListener("click",hide);

// Init
centerPlayer();
show("menu");

requestAnimationFrame(t=>{
  last=t;
  loop(t);
});

window.addEventListener("resize",()=>{
  if(state!=="playing")centerPlayer();
});
</script>

</body>
</html>
